<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>다음 지도 API</title>
  </head>

  <body>
    <div id="map" style="width: 375px; height: 812px"></div>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=0267e8b0ff131216ffd7a316cfda8d7a&libraries=clusterer"></script>
    <script>
      const url =
      "https://api.odcloud.kr/api/15067396/v1/uddi:1ac21e9c-ff05-4911-9772-b19a6310b1c3?page=1&perPage=100&serviceKey=pyrAeFiu8z3NrKs4qD%2FP1uaXIpIel%2ByJs0N3l375UbMi6JUsKsfgu9Ci4oD0ed2Ok5BgtdEE0Pl8o5DVWxyjPA%3D%3D";

      // 인포윈도우 표시 열기
      function mouseOverListener(map, marker, infoWindow) {
        return function () {
          infoWindow.open(map, marker);
        };
      }

      // 인포윈도우 표시 닫기
      function mouseOutListener(infoWindow) {
        return function () {
          infoWindow.close();
        };
      }

      var mapContainer = document.getElementById("map"), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(37.5518911, 126.9917937), // 지도의 중심좌표
          level: 6, // 지도의 확대 레벨
          mapTypeId: kakao.maps.MapTypeId.ROADMAP, // 지도종류
        };

      // 지도를 생성한다
      var map = new kakao.maps.Map(mapContainer, mapOption);

      // 마커 이미지의 주소
		var markerImageUrl = 'https://t1.daumcdn.net/localimg/localimages/07/2012/img/marker_p.png', 
        markerImageSize = new kakao.maps.Size(30, 32), // 마커 이미지의 크기
        markerImageOptions = { 
            offset : new kakao.maps.Point(15, 32)// 마커 좌표에 일치시킬 이미지 안의 좌표
        };

    // 마커 이미지를 생성한다
    var markerImage = new kakao.maps.MarkerImage(markerImageUrl, markerImageSize, markerImageOptions);

      var clusterer = new kakao.maps.MarkerClusterer({
        map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체
        averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정
        minLevel: 5, // 클러스터 할 최소 지도 레벨
      });

      fetch(url)
        .then((res) => res.json())
        .then((resJson) => { 
            const contents = resJson.data;

            console.log(contents);

          var markers = [];

          // 센터 좌표 리스트
          var centers = resJson.data;
          for (var i = 0; i < centers.length; i++) {
            var lat = centers[i]["기점_위도(WGS84(4326))"];
            var lng = centers[i]["기점_경도(WGS84(4326))"];

            var marker = new kakao.maps.Marker({
              position: new kakao.maps.LatLng(lat, lng),
              image: markerImage,
              map: map,
            });

            var infoWindow = new kakao.maps.InfoWindow({
              content: centers[i]["도로(노선)명"],
            });

            // 마커 추가
            markers.push(marker);

            // 마커 이벤트리스너 등록
            kakao.maps.event.addListener(
              marker,
              "mouseover",
              mouseOverListener(map, marker, infoWindow)
            );
            kakao.maps.event.addListener(
              marker,
              "mouseout",
              mouseOutListener(infoWindow)
            );
          }

          clusterer.addMarkers(markers);
        });
    </script>
  </body>
</html>
